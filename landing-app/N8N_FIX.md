# üîß –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å n8n workflow –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ payload

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–†–∞–Ω—å—à–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å —Ç–∞–∫:
```json
{
  "clientId": "...",
  "message": "...",
  "history": [...],
  "meta": {...}
}
```

–¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ –∫–ª—é—á `data`:
```json
{
  "data": {
    "clientId": "...",
    "message": "...",
    "history": [...],
    "meta": {...}
  }
}
```

## –ì–¥–µ —á—Ç–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –≤ n8n

### 1. Code in JavaScript (–ø–æ—Å–ª–µ AI Agent)

**–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–¥—É "Code in JavaScript"** –∏ –Ω–∞–π–¥–∏—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```javascript
return [{
  json: {
    reply: $json.output || $json.reply || $json.text || $json.message || "–û—à–∏–±–∫–∞: –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞"
  }
}];
```

**–ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞:**

```javascript
return [{
  json: {
    reply: $json.output || $json.reply || $json.text || $json.message || "–û—à–∏–±–∫–∞: –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞"
  }
}];
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ï—Å–ª–∏ AI Agent –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ `$json.output`, —Ç–æ –ø—É—Ç—å –æ—Å—Ç–∞–µ—Ç—Å—è `$json.output` (—ç—Ç–æ –≤—ã—Ö–æ–¥ –æ—Ç AI Agent, –Ω–µ –≤—Ö–æ–¥ –æ—Ç webhook).

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ webhook (–Ω–∞–ø—Ä–∏–º–µ—Ä, `$json.clientId`), —Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `$json.data.clientId`.

---

### 2. Respond to Webhook (–ø–æ—Å–ª–µ Code in JavaScript)

**–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–¥—É "Respond to Webhook"**

–ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ **"Response Body"** –∏–ª–∏ **"JSON"**, –≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ:

```json
{
  "reply": "{{ $json.reply }}"
}
```

**–û—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å!** –ó–¥–µ—Å—å `$json.reply` - —ç—Ç–æ –≤—ã—Ö–æ–¥ –æ—Ç "Code in JavaScript", –∞ –Ω–µ –≤—Ö–æ–¥ –æ—Ç webhook, –ø–æ—ç—Ç–æ–º—É –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

---

### 3. AI Agent (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ webhook)

**–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–¥—É "AI Agent"**

–ï—Å–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö AI Agent –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ webhook (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–æ–º–ø—Ç–µ –∏–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—è—Ö), —Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:

- `{{ $json.clientId }}` ‚Üí `{{ $json.data.clientId }}`
- `{{ $json.message }}` ‚Üí `{{ $json.data.message }}`
- `{{ $json.history }}` ‚Üí `{{ $json.data.history }}`
- `{{ $json.meta }}` ‚Üí `{{ $json.data.meta }}`

**–ù–æ –æ–±—ã—á–Ω–æ AI Agent —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞–ø—Ä—è–º—É—é –æ—Ç Webhook**, –∏ n8n –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ —É–∫–∞–∑–∞–Ω—ã –ª–∏ –≥–¥–µ-—Ç–æ —è–≤–Ω—ã–µ –ø—É—Ç–∏ –∫ `$json.clientId` –∏–ª–∏ `$json.message`.

---

### 4. Prepare Log Row (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–¥—É "Prepare Log Row"** (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)

–ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ webhook:

```javascript
// –ë–´–õ–û:
const clientId = $json.clientId;
const message = $json.message;
```

**–ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞:**

```javascript
// –°–¢–ê–õ–û:
const clientId = $json.data.clientId;
const message = $json.data.message;
```

---

### 5. Append row in sheet (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–¥—É "Append row in sheet"**

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –≥–¥–µ –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `$json` –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ —Å—Ç–æ–ª–±—Ü—ã, –∏–∑–º–µ–Ω–∏—Ç–µ:

- `{{ $json.clientId }}` ‚Üí `{{ $json.data.clientId }}`
- `{{ $json.message }}` ‚Üí `{{ $json.data.message }}`
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π

---

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n
2. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `$json.clientId`, `$json.message`, `$json.history`, `$json.meta`
3. –ï—Å–ª–∏ —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ webhook (–≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ), –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ `$json.data.clientId`, `$json.data.message` –∏ —Ç.–¥.
4. –ï—Å–ª–∏ —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Ç AI Agent (–≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ), –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å - `$json.output`, `$json.reply` –∏ —Ç.–¥.

---

## –ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –º–µ–Ω—è—Ç—å?

**–ú–µ–Ω—è—Ç—å –Ω—É–∂–Ω–æ:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç Webhook (–≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- ‚úÖ –õ—é–±—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `$json.clientId`, `$json.message`, `$json.history`, `$json.meta` –≤ –Ω–∞—á–∞–ª–µ workflow

**–ù–ï –º–µ–Ω—è—Ç—å:**
- ‚ùå –î–∞–Ω–Ω—ã–µ –æ—Ç AI Agent (`$json.output`, `$json.reply`)
- ‚ùå –î–∞–Ω–Ω—ã–µ –æ—Ç Code in JavaScript (`$json.reply` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- ‚ùå –î–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏ –≤ workflow (–æ–Ω–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–î–æ:**
```javascript
// –í AI Agent –∏–ª–∏ –≤ –Ω–∞—á–∞–ª–µ workflow
const clientId = $json.clientId;  // ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢
const message = $json.message;     // ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢
```

**–ü–æ—Å–ª–µ:**
```javascript
// –í AI Agent –∏–ª–∏ –≤ –Ω–∞—á–∞–ª–µ workflow  
const clientId = $json.data.clientId;  // ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
const message = $json.data.message;     // ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
```

---

## –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –∫–∞–∂–¥—É—é –Ω–æ–¥—É (–∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–¥—É ‚Üí "Execution Data")
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ Webhook –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `$json.data.*`
5. –û–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ

